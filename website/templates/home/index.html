{% load dajaxice_templatetags %}

<html xmlns="http://www.w3.org/1999/html">
    <head>
        <script type="text/javascript" src="{{ STATIC_URL }}apwan/js/lib/jquery-1.8.3.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}dajax/jquery.dajax.core.js"></script>
        {% dajaxice_js_import %}
    </head>

    <body>
        <center>
            <h2>entity.search</h2>
            <input type="text" id="search_title" placeholder="Title" style="width: 300px;" /><br/>
            <br/>
            <input type="text" id="search_artist" placeholder="Artist" style="width: 300px;" /><br/>
            <input type="text" id="search_album" placeholder="Album" style="width: 300px;" /><br/>
            <input type="text" id="search_track" placeholder="Track" style="width: 300px;" /><br/>
            <select id="search_type">
                <option value="">Unknown</option>
                <option value="0">TV Show</option>
                <option value="1">Movie</option>
                <option value="2" selected>Music</option>
                <option value="3">Game</option>
            </select>
            <button id="search_submit">Search</button>
            <button onclick="load_example_data();">Example Data</button>

            <div id="results">

            </div>
        </center>

        <script type="text/javascript">
            var example_data = {
                0: ['Chuck', 'Eureka', 'Fringe'],
                1: ['The Hitchhiker\'s Guide to the Galaxy', 'Skyfall', 'Taken', 'Taken 2'],
                2: [
                    {
                        'artist': "M83"
                    },
                    {
                        'artist': "M83",
                        'track': "Intro"
                    },
                    {
                        'artist': "Everything Everything",
                        'album': "Arc"
                    },
                    {
                        'artist': "Everything Everything",
                        'track': "Weights"
                    }
                ],
                3: []
            };

            var _search_type = $('#search_type');
            var _search_title = $('#search_title');
            var _search_artist = $('#search_artist');
            var _search_album = $('#search_album');
            var _search_track = $('#search_track');
            var _results = $('#results');

            $('#search_submit').click(do_search);
            _search_title.keydown(function(event) {
                if(event.keyCode == 13)
                {
                    do_search();
                }
            });

            function get_val(element)
            {
                var val = null;
                if(element.val() != '') {
                    val = element.val();
                }
                return val;
            }

            function load_example_data()
            {
                var type = parseInt(_search_type.val());
                var rand = Math.floor(Math.random() * example_data[type].length);

                if(type == 2) {
                    _search_title.val('');
                    _search_artist.val(example_data[type][rand]['artist']);
                    _search_album.val(example_data[type][rand]['album']);
                    _search_track.val(example_data[type][rand]['track']);
                } else {
                    _search_title.val(example_data[type][rand]);
                    _search_artist.val('');
                    _search_album.val('');
                    _search_track.val('');
                }
            }
            load_example_data();

            function process_result(result)
            {
                console.log('success: ' + result.success);

                if(result.success)
                {
                    for(var i = 0; i < result.items.length; i++)
                    {
                        console.log(result.items[i]);
                        if(result.items[i].type == 2) // if MUSIC
                        {
                            _results.prepend("<div style=\"width: 300px; border: 1px solid black; margin: 3px; padding: 3px; text-align: left;\">" +
                                    "<b>ID:</b> <span>\"" + result.items[i].id + "\"</span><br/>" +
                                    "<br/>" +
                                    "<b>Artist:</b> <span>\"" + result.items[i].artist + "\"</span><br/>" +
                                    "<b>Album:</b> <span>\"" + result.items[i].album + "\"</span><br/>" +
                                    "<b>Track:</b> <span>\"" + result.items[i].track + "\"</span><br/>" +
                                    "<br/>" +
                                    "<b>Image:</b> <span>\"" + result.items[i].image + "\"</span><br/>" +
                                    "</div>");
                        } else {
                            _results.prepend("<div style=\"width: 300px; border: 1px solid black; margin: 3px; padding: 3px; text-align: left;\">" +
                                    "<b>ID:</b> <span>\"" + result.items[i].id + "\"</span><br/>" +
                                    "<br/>" +
                                    "<b>Title:</b> <span>\"" + result.items[i].title + "\"</span><br/>" +
                                    "<br/>" +
                                    "<b>Image:</b> <span>\"" + result.items[i].image + "\"</span><br/>" +
                                    "</div>");
                        }
                    }
                }
            }

            function do_search()
            {
                var type = null;
                if(_search_type.val() != '') {
                    type = parseInt(_search_type.val());
                }

                var params = {}

                if(type == 2)
                {
                    var artist = get_val(_search_artist);
                    var album = get_val(_search_album);
                    var track = get_val(_search_track);

                    console.log("Searching '" + artist + "','" + album + "','" + track + "', (" + type + ")");

                    params = {'type':type, 'artist': artist};
                    if(album != null) params['album'] = album;
                    if(track != null) params['track'] = track;

                    Dajaxice.entity.search(function(result) {
                        process_result(result);
                    }, params);
                } else {
                    var title = get_val(_search_title);

                    console.log("Searching '" + title + "', (" + type + ")");

                    params = {'type':type, 'title': title};

                    Dajaxice.entity.search(function(result) {
                        process_result(result);
                    }, params);
                }
            }
        </script>
    </body>
</html>